<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C1 Speaking: Part 1</title>
    <style>
        :root {
            --cambridge-blue: #0072bc;
            --bg: #f4f7f9;
            --disabled: #94a3b8;
            --success: #16a34a;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 550px; text-align: center; }
        h2 { color: var(--cambridge-blue); margin-top: 0; }
        #status-text { font-style: italic; color: #666; margin: 20px 0; min-height: 1.2em; font-weight: 500; }
        .mic-container { margin: 15px 0; }
        .mic-icon { width: 70px; height: 70px; background: #eee; border-radius: 50%; display: inline-flex; justify-content: center; align-items: center; font-size: 28px; transition: 0.3s; }
        .listening { background: #ff4b2b; color: white; box-shadow: 0 0 20px rgba(255, 75, 43, 0.5); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .btn { background: var(--cambridge-blue); color: white; border: none; padding: 14px 30px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; transition: background 0.3s; margin-bottom: 5px; }
        .btn:disabled { background: var(--disabled); cursor: not-allowed; opacity: 0.8; }
        #live-commentary { margin-top: 15px; padding: 12px; background: #f8fafc; border-radius: 6px; min-height: 60px; font-size: 14px; color: #334155; border: 1px solid #e2e8f0; text-align: left; line-height: 1.5; }
        #feedback-area { display: none; margin-top: 25px; text-align: left; padding: 20px; background: #fff; border: 1px solid #cbd5e1; border-radius: 10px; }
        .feedback-label { font-weight: 800; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 8px; color: var(--success); }
        .tag-achieved { display: inline-block; padding: 3px 10px; border-radius: 15px; font-size: 11px; margin-right: 6px; margin-top: 6px; font-weight: bold; background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .eval-box { font-size: 13px; color: #475569; margin-top: 15px; border-top: 1px solid #f1f5f9; padding-top: 10px; line-height: 1.5; }
    </style>
</head>
<body>

<div class="card">
    <h2>Speaking Part 1</h2>
    <p>Social Interview (2 Minutes)</p>
    <div id="status-text">Click Start to meet the A.I. Examiner</div>
    <div class="mic-container"><div id="mic" class="mic-icon">üéôÔ∏è</div></div>
    <button id="start-btn" class="btn" onclick="initMic()">START EXAM</button>
    <div id="live-commentary">Waiting for speech...</div>

    <div id="feedback-area">
        <div class="feedback-section">
            <span class="feedback-label">Natural Connectors Recognized:</span>
            <div id="achieved-list"></div>
        </div>
        <div class="eval-box">
            <strong>Exam Requirements:</strong><br>
            In this part of the C1 Advanced test, examiners look for your ability to link ideas and use general social language to talk about yourself, your interests, work and future plans (although topics may vary), focusing on fluency, coherence, vocabulary and grammar. You need to give full, natural answers, not just one-word responses and show good pronunciation that is generally intelligible.
        </div>
        
        <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
            <button class="btn" onclick="window.location.href='part2.html'" style="background: #16a34a; width: 100%;">
                GO TO PART 2 ‚Üí
            </button>
        </div>
    </div>
</div>

<script>
    const questions = [
        "First of all, we'd like to know something about you. Where are you from?",
        "What do you enjoy most about the area where you live?",
        "Do you prefer to spend your free time alone or with other people? Why?",
        "How important is it to speak more than one language in today's world?"
    ];

    const masterBank = ["important", "think", "originally", "currently", "enjoy", "useful", "prefer", "always", "necessarily", "create", "would like to", "represent", "as well as", "despite this", "therefore", "hand", "due to", "instance", "such as", "opinion", "although"];

    let currentQ = 0;
    let foundMarkers = new Set();
    const status = document.getElementById('status-text');
    const mic = document.getElementById('mic');
    const startBtn = document.getElementById('start-btn');
    const feedbackArea = document.getElementById('feedback-area');
    const achievedList = document.getElementById('achieved-list');
    const commentary = document.getElementById('live-commentary');

    const synth = window.speechSynthesis;
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = 'en-GB';

    recognition.onresult = (event) => {
        let interimTranscript = '';
        for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript.toLowerCase();
            if (event.results[i].isFinal) {
                masterBank.forEach(marker => { if (transcript.includes(marker)) foundMarkers.add(marker); });
            } else { interimTranscript += transcript; }
        }
        if (interimTranscript !== '') commentary.innerText = interimTranscript;
    };

    async function initMic() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            stream.getTracks().forEach(track => track.stop());
            startExam();
        } catch (e) {
            status.innerText = "Please allow microphone access in your browser.";
        }
    }

    function speak(text, callback) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'en-GB';
        utter.rate = 0.95;
        utter.onend = callback;
        synth.speak(utter);
    }

    function startExam() {
        startBtn.disabled = true;
        startBtn.innerText = "EXAM IN PROGRESS...";
        nextQuestion();
    }

    function nextQuestion() {
        if (currentQ < questions.length) {
            status.innerText = "A.I. Examiner is speaking...";
            mic.classList.remove('listening');
            commentary.innerText = "Wait for question...";
            
            // Stop mic to give AI full system resources for high-quality audio
            try { recognition.stop(); } catch(e) {}

            speak(questions[currentQ], () => {
                status.innerText = "Your turn (25 seconds)...";
                commentary.innerText = "Listening...";
                mic.classList.add('listening');
                
                // Restart mic for student response
                try { recognition.start(); } catch(e) {}
                
                setTimeout(() => { 
                    currentQ++; 
                    nextQuestion(); 
                }, 25000);
            });
        } else { finishExam(); }
    }

    function finishExam() {
        status.innerText = "Interview Complete.";
        mic.classList.remove('listening');
        try { recognition.stop(); } catch(e) {}
        
        startBtn.innerText = "FINISHED";
        startBtn.style.background = "#94a3b8";
        feedbackArea.style.display = 'block';
        
        if (foundMarkers.size > 0) {
            achievedList.innerHTML = Array.from(foundMarkers).map(m => `<span class="tag-achieved">${m.toUpperCase()}</span>`).join('');
        } else {
            achievedList.innerHTML = "<em style='font-size:12px; color:#94a3b8;'>Natural flow detected. Remember to use full sentences to link your ideas.</em>";
        }
    }
</script>
</body>

</html>
